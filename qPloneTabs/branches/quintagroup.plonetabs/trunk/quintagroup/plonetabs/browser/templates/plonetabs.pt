<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xml:lang="en" lang="en"
      metal:use-macro="context/prefs_main_template/macros/master"
      i18n:domain="quintagroup.plonetabs">

<metal:block metal:fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border', 1)" />

<body>

<div metal:fill-slot="prefs_configlet_main"
     tal:define="test nocall:view/test;
                 category here/REQUEST/category|nothing;
                 category python:test(category and category != '', category, 'portal_tabs');
                 errors options/errors|nothing">

<div id="plonetabs_form">

<div id="app" class="viewing">

  <h1 class="documentFirstHeading">
    <span i18n:translate="heading_plonetabs">
      <tal:title replace="python:view.getPageTitle(category)">Plone Tabs</tal:title>
    </span>
    <span id="busy"><img src="++resource++busy_icon.gif" alt="" tal:attributes="src string:${portal_url}/${attrs/src}" /></span>
  </h1>

  <a href=""
     class="link-parent"
     tal:attributes="href string: $portal_url/plone_control_panel"
     i18n:domain="plone"
     i18n:translate="label_up_to_plone_setup">
    Up to Site Setup
  </a>

  <div i18n:translate="description_plonetabs">
    <form id="selectcategory_form"
          name="selectcategory_form"
          method="post"
          action="@@plonetabs-controlpanel"
          tal:attributes="action string:${portal_url}/${attrs/action}">
      <div class="field"
           tal:define="error errors/select_category|nothing"
           tal:attributes="class python:test(error, 'field error', 'field')">
        <div tal:replace="error">Error output</div>
        <label for="select_category" i18n:translate="label_select_category">Select category to manage</label>
        <select name="category"
                id="select_category"
                tal:define="categories view/getCategories">
          <option value="current_category" selected="selected"
                  tal:attributes="value category"
                  tal:content="category" />
          <tal:options repeat="cat categories">
            <option tal:attributes="value cat"
                    tal:content="cat"
                    tal:condition="python: cat != category" />
          </tal:options>
        </select>
        <input class="change-button" type="submit" name="category.change" value="Change" />
      </div>
    </form>
  </div>

  <div class="reorder-controls"
       tal:define="notempty python:view.hasActions(category)">
    <a href="#" id="reorder" class=""
       tal:attributes="class python:test(notempty, '', 'noitems')">Reorder</a>
  </div>

  <div class="sort-controls">
    <a href="#" id="save">Save</a> |
    <a href="#" id="cancel">Cancel</a>
  </div>

  <ul class="csshover"
      id="tabslist"
      tal:content="structure python:view.getActionsList(category=category, errors=errors)" />

  <form id="addaction"
        name="addaction_form"
        method="post"
        action="@@plonetabs-controlpanel"
        tal:attributes="action string:${portal_url}/${attrs/action}">
    <input type="hidden" name="form.submitted:boolean" value="True" />
    <input type="hidden" name="category" value="category" tal:attributes="value category" />
    <dl class="field-visible bridge">
      <dt>
        <label>Visible</label>
      </dt>
      <dd>
        <input id="actvisible" type="checkbox" value="1" checked="checked" title="visibility" name="visible"
               tal:attributes="checked request/visible|string:checked" />
      </dd>
    </dl>
    <dl class="field-name"
        tal:define="error errors/title|nothing"
        tal:attributes="class python:test(error, '%s error' % attrs['class'], attrs['class'])">
      <dt>
        <label>Name</label>
      </dt>
      <dd>
        <span class="error-container" tal:content="error">Validation error output</span>
        <input id="actname" type="text" value="" name="title"
               tal:attributes="value request/title|nothing"/>
      </dd>
    </dl>
    <dl class="field-action"
        tal:define="error errors/url_expr|nothing"
        tal:attributes="class python:test(error, '%s error' % attrs['class'], attrs['class'])">
      <dt>
        <label>URL (Expression)</label>
      </dt>
      <dd>
        <span class="error-container" tal:content="error">Validation error output</span>
        <input id="actaction" type="text" value="" size="30" name="url_expr"
               tal:attributes="value request/url_expr|nothing"/>
      </dd>
    </dl>
    <dl class="collapseAdvanced expandedBlock">
      <dt class="headerAdvanced">Advanced</dt>
      <dd class="contentAdvanced">
        <dl class="field-id"
            tal:define="error errors/id|nothing"
            tal:attributes="class python:test(error, '%s error' % attrs['class'], attrs['class'])">
          <dt>
            <label>Id</label>
          </dt>
          <dd>
            <span class="error-container" tal:content="error">Validation error output</span>
            <input id="actid" type="text" value="" name="id"
                   tal:attributes="value request/id|nothing" />
          </dd>
        </dl>
        <dl class="field-condition"
            tal:define="error errors/available_expr|nothing"
            tal:attributes="class python:test(error, '%s error' % attrs['class'], attrs['class'])">
          <dt>
            <label>Condition (Expression)</label>
          </dt>
          <dd>
            <span class="error-container" tal:content="error">Validation error output</span>
            <input id="actcondition" type="text" value="" size="30" name="available_expr"
                   tal:attributes="value request/available_expr|nothing" />
          </dd>
        </dl>
        <div class="visualClear"><!-- --></div>
      </dd>
    </dl>
    <div class="add-controls">
      <input type="submit" id="buttonadd" i18n:attributes="value" name="add.add" value="Add" />
      <input type="submit" id="buttoncancel" i18n:attributes="value" name="add.cancel" value="Cancel" />
    </div>
  </form>

  <div id="autogeneration_section" tal:condition="python:category == 'portal_tabs'">

    <form name="generated_tabs_form"
          action="@@plonetabs-controlpanel"
          method="post"
          tal:attributes="action string:${portal_url}/${attrs/action}">

      <input type="hidden" name="form.submitted:boolean" value="True" />

      <div class="field"
           tal:define="generated_tabs request/generated_tabs|view/isGeneratedTabs;
                       error errors/generated_tabs|nothing"
           tal:attributes="class python:test(error, 'field error', 'field')">
        <input type="checkbox"
               id="generated_tabs"
               name="generated_tabs"
               value="1"
               tal:attributes="checked python:test(generated_tabs, 'checked', None)" />
        <label for="generated_tabs" i18n:translate="label_generated_tabs_enable">Automatically generate tabs</label>
        <div class="formHelp" i18n:translate="help_generated_tabs">
          By default, all folders created at the root level will have global section
          navigation generated. You can turn this off if you prefer manually constructing
          this part of the navigation.
        </div>
      </div>

      <div class="field"
           tal:define="nonfolderish_tabs request/nonfolderish_tabs|view/isNotFoldersGenerated;
                       error errors/nonfolderish_tabs|nothing"
           tal:attributes="class python:test(error, 'field error', 'field')">
        <input type="checkbox"
               id="nonfolderish_tabs"
               name="nonfolderish_tabs"
               value="1"
               tal:attributes="checked python:test(nonfolderish_tabs, 'checked', None)" />
        <label for="nonfolderish_tabs" i18n:translate="label_nonfolderish_tabs_enable">Generate tabs for items other than folders</label>
        <div class="formHelp" i18n:translate="help_nonfolderish_tabs">
          By default, any content item in the root of the portal will be shown as
          a global section. If you turn this option off, only folders will be shown.
          This only has an effect if "Automatically generate tabs" is enabled
        </div>
      </div>

      <ul class="csshover" id="roottabs"
          tal:content="structure view/getGeneratedTabs" />

      <div id="autogeneration_controls">
          <input class="submit-button" type="submit" name="autogenerated.save" value="Save" />
      </div>

    </form>

  </div>

</div>

</div>

</div>

</body>
</html>
